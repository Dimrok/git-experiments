before_script:
  - |

       declare -r SSH_FILE="$(mktemp -u $HOME/.ssh/XXXXXX)"

       # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

       # Decrypt the file containing the private key
       # (Note: this is the same as what is generated by the Travis CLI at step 2.5)

       openssl aes-256-cbc \
         -K $encrypted_93302a4c01a9_key \
         -iv $encrypted_93302a4c01a9_iv \
         -in ".travis/GitHub.enc" \
         -out "$SSH_FILE" -d

       # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

       # Enable SSH authentication

       chmod 600 "$SSH_FILE" \
         && printf "%s\n" \
              "Host github.com" \
              "  IdentityFile $SSH_FILE" \
              "  LogLevel ERROR" >> ~/.ssh/config

script:
  - git remote add GitHub git@github.com:$TRAVIS_REPO_SLUG.git
  - mkdir -p .status
  - mkdir -p .coverage
  - make

after_script:
  # Add tests status.
  - git checkout "$TRAVIS_COMMIT"
  - git fetch GitHub/meta/status/$TRAVIS_BRANCH
  - git checkout -b meta/status/$TRAVIS_BRANCH
  - git add .status
  - git commit -m "$TRAVIS_COMMIT" --allow-empty
  - git push --force GitHub HEAD:refs/heads/meta/tests/$TRAVIS_BRANCH
  # Add coverage status.
  - git checkout "$TRAVIS_COMMIT"
  - git fetch GitHub/meta/coverage/$TRAVIS_BRANCH
  - git checkout -b meta/coverage/$TRAVIS_BRANCH
  - git add .coverage
  - git commit -m "$TRAVIS_COMMIT" --allow-empty
  - git push GitHub HEAD:refs/heads/meta/tests/$TRAVIS_BRANCH

# blocklist
branches:
  except:
  - /^meta/.*$/
